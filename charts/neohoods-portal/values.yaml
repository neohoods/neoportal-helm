# Global variables for templating
global:
  namespace: platform
  domain: portal.neohoods.com
  chatName: neohoods
  emailTemplate:
    logoUrl: "https://portal.neohoods.com/logo-bright.png"
    appName: "NeoHoods"

postgresql:
  enabled: true
  shmSize: "1Gi"
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: latest
    pullPolicy: IfNotPresent

  primary:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

  auth:
    database: neohoods_portal
    username: neohoods_portal_user
    existingSecret: neohoods-postgresql
    secretKeys:
      adminPasswordKey: postgresql-password
      userPasswordKey: postgresql-password
      replicationPasswordKey: postgresql-password
# Backend settings
backend:
  enabled: true
  debug:
    enabled: false # Set to true in dev environment
  image:
    repository: ghcr.io/neohoods/portal-platform-api
    tag: 0.0.284
  replicaCount: 2
  service:
    type: NodePort
    port: 80
    nodePort: 30096
    nodePortForDebug: 30197
  env:
    # Spring properties
    SERVER_PORT: 8486
    SPRING_PROFILES_ACTIVE: production
    SPRING_DATASOURCE_USERNAME: neohoods_portal_user
    SPRING_DATASOURCE_URL: jdbc:postgresql://neohoods-postgresql.platform.svc.cluster.local:5432/neohoods_portal
    # OpenTelemetry configuration - using existing Tempo/Loki/Prometheus stack
    MANAGEMENT_OTLP_METRICS_ENABLED: "true"
    MANAGEMENT_OTLP_TRACING_ENABLED: "true"
    MANAGEMENT_METRICS_EXPORT_OTLP_ENABLED: "true"
    MANAGEMENT_OTLP_METRICS_URL: "http://tempo.observability.svc.cluster.local:4317/v1/metrics"
    MANAGEMENT_OTLP_TRACING_URL: "http://tempo.observability.svc.cluster.local:4317/v1/traces"
    MANAGEMENT_METRICS_EXPORT_OTLP_URL: "http://tempo.observability.svc.cluster.local:4317/v1/metrics"
    # Auth0 properties
    AUTH0_DOMAIN: terresdelaya.eu.auth0.com
    AUTH0_CLIENT_ID:
      secretKeyRef:
        name: auth0-secret
        key: auth0-client-id
    AUTH0_CLIENT_SECRET:
      secretKeyRef:
        name: auth0-secret
        key: auth0-client-secret
    AUTH0_AUDIENCE: https://terresdelaya.eu.auth0.com/api/v2/
    AUTH0_CONNECTION: Username-Password-Authentication
    # Stripe properties
    STRIPE_SECRET_KEY:
      secretKeyRef:
        name: stripe-secret
        key: stripe-secret-key
    STRIPE_PUBLISHABLE_KEY:
      secretKeyRef:
        name: stripe-secret
        key: stripe-publishable-key
    STRIPE_WEBHOOK_SECRET:
      secretKeyRef:
        name: stripe-secret
        key: stripe-webhook-secret
    JWT_SECRET:
      secretKeyRef:
        name: portal-secret
        key: jwt-secret
    NEOHOODS_PORTAL_MAIL_SILENT_MODE: "false"
    NEOHOODS_PORTAL_MAIL_WHITELIST: "quentincastel86@gmail.com"
    # SSO configuration
    NEOHOODS_PORTAL_SSO_ENABLED: "false"
    NEOHOODS_PORTAL_SSO_CLIENT_ID:
      secretKeyRef:
        name: portal-secret
        key: sso-client-id
    NEOHOODS_PORTAL_SSO_CLIENT_SECRET:
      secretKeyRef:
        name: portal-secret
        key: sso-client-secret
    NEOHOODS_PORTAL_SSO_TOKEN_ENDPOINT: ""
    NEOHOODS_PORTAL_SSO_AUTHORIZATION_ENDPOINT: ""
    NEOHOODS_PORTAL_SSO_SCOPE: "openid profile email"
    # Matrix configuration
    MATRIX_BOT_ENABLED: "true"
    MATRIX_BOT_DISABLED: "false"
    MATRIX_HOMESERVER_URL: "matrix.neohoods.com"
    MATRIX_SERVER_NAME: "chat.neohoods.com"
    MATRIX_SPACE_ID: "!YenniyNVsUoBCLHtZS:chat.neohoods.com"
    MATRIX_INITIALIZATION_ENABLED: "true"
    MATRIX_MAS_URL: "https://mas.chat.neohoods.com"
    MATRIX_ROOMS_CONFIG_FILE: "file:/app/matrix-default-rooms.yaml"
    MATRIX_INITIALIZATION_ADMIN_USERS: "@quentincastel86:chat.neohoods.com"
    MATRIX_OAUTH2_CLIENT_ID:
      secretKeyRef:
        name: matrix-secret
        key: oauth2-client-id
    MATRIX_OAUTH2_CLIENT_SECRET:
      secretKeyRef:
        name: matrix-secret
        key: oauth2-client-secret
    MATRIX_OAUTH2_REDIRECT_URI: "https://portal.neohoods.com/api/admin/matrix-bot/oauth2/callback"
    MATRIX_OAUTH2_SCOPE: "urn:matrix:client:api:* urn:synapse:admin:* urn:matrix:client:device:BOT-PERMANENT-TOKEN"
    MATRIX_OAUTH2_AUTHORIZATION_ENDPOINT: "https://matrix.neohoods.com/_matrix/client/v3/oauth2/authorize"
    MATRIX_OAUTH2_TOKEN_ENDPOINT: "https://matrix.neohoods.com/_matrix/client/v3/oauth2/token"
    MATRIX_OAUTH2_DEVICE_AUTHORIZATION_ENDPOINT: "https://mas.chat.neohoods.com/oauth2/device"
    # Matrix Local Assistant configuration (Alfred)
    MATRIX_LOCAL_ASSISTANT_ENABLED: "true"
    MATRIX_LOCAL_ASSISTANT_USER_ID: "@alfred:chat.neohoods.com"
    MATRIX_LOCAL_ASSISTANT_PERMANENT_TOKEN:
      secretKeyRef:
        name: matrix-secret
        key: local-assistant-permanent-token
    MATRIX_LOCAL_ASSISTANT_AVATAR_URL: "https://neohoods.com/assets/chat/alfred-avatar.png"
    MATRIX_LOCAL_ASSISTANT_DISPLAY_NAME: "Alfred [Assistant AI]"
    MATRIX_LOCAL_ASSISTANT_SPACE_ID: "" # If empty, uses MATRIX_SPACE_ID
    # Assistant AI configuration
    ASSISTANT_AI_ENABLED: "true"
    ASSISTANT_AI_PROVIDER: "mistral"
    MISTRAL_AI_TOKEN:
      secretKeyRef:
        name: matrix-secret
        key: mistral-ai-token
    ASSISTANT_AI_MODEL: "devstral-medium-latest" # Default model (fallback)
    # Assistant AI Agent Models (per-agent customization)
    ASSISTANT_AI_AGENT_ROUTER_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_GENERAL_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_RESIDENT_INFO_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_SPACE_MODEL: "devstral-medium-latest"
    # Assistant AI Agent Space Step Models (per-step customization)
    ASSISTANT_AI_AGENT_SPACE_STEP_REQUEST_SPACE_INFO_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_SPACE_STEP_CHOOSE_SPACE_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_SPACE_STEP_CONFIRM_RESERVATION_SUMMARY_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_SPACE_STEP_COMPLETE_RESERVATION_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_SPACE_STEP_PAYMENT_INSTRUCTIONS_MODEL: "devstral-medium-latest"
    ASSISTANT_AI_AGENT_HELP_MODEL: "devstral-medium-latest"
    # Assistant LLM Judge configuration
    ASSISTANT_LLM_JUDGE_ENABLED: "true"
    # Assistant Conversation configuration
    ASSISTANT_CONVERSATION_TIMEOUT_HOURS: "1" # Timeout in hours to create a new conversation
    ASSISTANT_CONVERSATION_DATE_FORMAT_TIMEZONE: "UTC" # Timezone for date format
    # Assistant RAG configuration
    ASSISTANT_RAG_ENABLED: "true"
    ASSISTANT_RAG_CUSTOM_DOC_FILE: "file:/app/rag-custom-documentation.md"
    # Assistant MCP configuration
    ASSISTANT_MCP_ENABLED: "true"
    ASSISTANT_MCP_BASE_URL: "http://localhost:8080/mcp"
    # Assistant Reminders configuration
    ASSISTANT_REMINDERS_ENABLED: "false"
    ASSISTANT_REMINDERS_BEFORE_HOURS: "24"
    ASSISTANT_REMINDERS_CHECKOUT_HOURS: "9"
    ASSISTANT_REMINDERS_FEEDBACK_DAYS: "1"
    # Assistant Notifications configuration
    ASSISTANT_NOTIFICATIONS_ENABLED: "false"
    # Matrix Exception Notification configuration
    MATRIX_EXCEPTION_NOTIFICATION_ENABLED: "true"
    GRAFANA_URL: "https://grafana.neohoods.com"
    # Cleaning Calendar configuration
    CLEANING_CALENDAR_JWT_SECRET:
      secretKeyRef:
        name: portal-secret
        key: cleaning-calendar-jwt-secret
    # Bot JWT configuration
    NEOHOODS_PORTAL_BOT_JWT_SECRET:
      secretKeyRef:
        name: portal-secret
        key: bot-jwt-secret
    NEOHOODS_PORTAL_BOT_JWT_ISSUER: "matrix-sync-bot"
    NEOHOODS_PORTAL_BOT_JWT_AUDIENCE: "neohoods-portal"
    # TV configuration
    NEOHOODS_PORTAL_TV_JWT_SECRET:
      secretKeyRef:
        name: portal-secret
        key: tv-jwt-secret
    NEOHOODS_PORTAL_TV_JWT_ISSUER: "tv-display"
    NEOHOODS_PORTAL_TV_JWT_AUDIENCE: "neohoods-portal"
    NEOHOODS_PORTAL_TV_MAX_SLIDES: "10"
    # Spaces platform fees configuration
    NEOHOODS_PORTAL_SPACES_DEFAULT_PLATFORM_FEE_PERCENTAGE: "2.00"
    NEOHOODS_PORTAL_SPACES_DEFAULT_PLATFORM_FIXED_FEE: "0.25"
  matrixRooms:
    enabled: true
    configMapName: "" # Default: {{ .Release.Name }}-matrix-rooms
    inline: "" # YAML content inline (optional)
    existingConfigMap: "" # Reference to existing ConfigMap (optional)
  ragDocumentation:
    enabled: false
    configMapName: "" # Default: {{ .Release.Name }}-rag-documentation
    inline: "" # Markdown content inline (optional). Use sections separated by "---" for multiple topics.
    existingConfigMap: "" # Reference to existing ConfigMap (optional). If set, uses this ConfigMap instead of creating one.
    # Example inline content:
    # inline: |
    #   ---
    #   Structure des bâtiments
    #   
    #   La copropriété a 3 bâtiments : A, B, C.
    #   Format : [Bâtiment][Étage][Numéro] (ex: A701, C302)
    #   ---
ingress:
  certManagerClusterIssuer: letsencrypt-prod
  secretName: letsencrypt-platform
# Frontend settings
frontend:
  enabled: true
  image:
    repository: ghcr.io/neohoods/portal-platform-ui
    tag: 0.0.284
  replicaCount: 1
  service:
    type: NodePort
    port: 80
    nodePort: 30095
  env:
    API_BASE_PATH: https://portal.neohoods.com
    USE_MOCK_API: "false"
    DEMO_MODE: "false"
    DEFAULT_LOCALE: "fr"
    # Branding configuration
    BRAND_NAME: "NeoHoods"
    BRAND_DISPLAY_NAME: "Portal NeoHoods"
    BRAND_COPYRIGHT: "2025 Portal NeoHoods"
    BRAND_LOGO: "/logo-bright.png"
    STRIPE_DEMO_MODE: "false"
  theme:
    configMapName: my-custom-theme
mailersend:
  enabled: true
  apiKey:
    secretKeyRef:
      name: mailersend-secret
      key: mailersend-api-key
  from:
    email: notifications@mail.neohoods.com
    name: NeoHoods
flyway:
  enabled: true
  url: jdbc:postgresql://neohoods-postgresql.platform.svc.cluster.local:5432/neohoods_portal
  fakeData: false
  image:
    repository: flyway/flyway
    tag: latest
    pullPolicy: IfNotPresent
  config:
    schemas: public
    locations: "filesystem:/flyway/sql"
  # Resource limits to prevent ephemeral-storage issues
  # Override these if you have large customInitData ConfigMaps
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
      ephemeral-storage: "500Mi"
    limits:
      memory: "512Mi"
      cpu: "500m"
      ephemeral-storage: "2Gi"
  # Custom initialization data
  customInitData:
    enabled: false
    configMapName: "portal-custom-init-data" # Name of the ConfigMap containing custom init data
    mountPath: "/flyway/sql-custom" # Mount path for custom data
    files: [] # List of SQL files with inline content
    sqlFiles: [] # List of SQL files to load from sql/ directory
